@page
@model IndexModel
@{
    ViewData["Title"] = "D&D Adventure";
}

<style>
.cantrip-item {
    cursor: pointer;
    padding: 8px;
    margin: 4px 0;
    border: 1px solid #ddd;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.cantrip-item:hover {
    background-color: #f8f9fa;
}

.cantrip-item.selected {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
}

.cantrip-item.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
</style>

<div class="container mt-4">
    <div class="text-center mb-5 fade-in-up">
        <h1 class="display-4 magical-border pulse-gold">D&D Choose Your Adventure</h1>
        <p class="lead">Create your character, choose your world, and begin your adventure!</p>
        <div class="mt-3">
            <span class="badge bg-primary me-2 interactive-hover">‚öîÔ∏è Epic Adventures</span>
            <span class="badge bg-success me-2 interactive-hover">üè∞ Vast Worlds</span>
            <span class="badge bg-warning interactive-hover">üé≤ Endless Possibilities</span>
        </div>
    </div>

    <!-- World Selection -->
    <div id="world-selection" class="mb-5">
        <h2>Select Your World</h2>
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="world-select" class="form-label">Choose World</label>
                            <select class="form-select" id="world-select" required>
                                <option value="" selected disabled>Select a World</option>
                                <option value="new">Create New World</option>
                                <!-- Existing worlds will be populated via JavaScript -->
                            </select>
                        </div>
                        
                        <!-- New World Form (initially hidden) -->
                        <div id="new-world-form" style="display: none;">
                            <div class="mb-3">
                                <label for="world-name" class="form-label">World Name</label>
                                <input type="text" class="form-control" id="world-name" required>
                            </div>
                            <div class="mb-3">
                                <label for="world-description" class="form-label">World Description</label>
                                <textarea class="form-control" id="world-description" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">World Details</h5>
                    </div>
                    <div class="card-body">
                        <div id="world-info">
                            <p class="text-muted">Select a world to view details</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import/Export -->
    <div id="import-export" class="mb-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Import/Export Data</h5>
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="file" class="form-control" id="import-file" accept=".json">
                            <button class="btn btn-primary" type="button" id="btn-import">Import</button>
                        </div>
                    </div>
                    <div class="col-md-6 text-end">
                        <button type="button" class="btn btn-secondary" id="btn-export">Export Current Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Character Creation -->
    <div id="character-creation" class="mb-5">
        <h2 class="mb-4">üé≠ Create Your Character</h2>
        
        <!-- Step 1: Basic Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h4 class="mb-0">üìù Step 1: Basic Information</h4>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="name" class="form-label">Character Name</label>
                        <input type="text" class="form-control" id="name" placeholder="Enter your character's name" required>
                    </div>
                    <div class="col-md-6">
                        <label for="background" class="form-label">Background (Optional)</label>
                        <select class="form-select" id="background">
                            <option value="">Choose Background</option>
                            <option value="Acolyte">Acolyte</option>
                            <option value="Criminal">Criminal</option>
                            <option value="Folk Hero">Folk Hero</option>
                            <option value="Noble">Noble</option>
                            <option value="Sage">Sage</option>
                            <option value="Soldier">Soldier</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Race Selection -->
        <div class="card mb-4">
            <div class="card-header">
                <h4 class="mb-0">üßù Step 2: Choose Your Race</h4>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="race" class="form-label">Race</label>
                        <select class="form-select" id="race" required>
                            <option value="" selected disabled>Select Race</option>
                            <!-- Races will be populated via JavaScript -->
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="subrace" class="form-label">Subrace</label>
                        <select class="form-select" id="subrace" style="display: none;">
                            <option value="" selected disabled>Select Subrace</option>
                        </select>
                    </div>
                </div>
                
                <!-- Race Information Panel -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div id="race-info-panel" class="p-3 bg-light rounded" style="display: none;">
                            <h6>Race Details</h6>
                            <div id="race-description"></div>
                            <div class="row mt-2">
                                <div class="col-md-6">
                                    <strong>Ability Score Increases:</strong>
                                    <ul id="race-ability-scores" class="list-group list-group-flush mt-1"></ul>
                                </div>
                                <div class="col-md-6">
                                    <strong>Racial Traits:</strong>
                                    <ul id="race-traits" class="list-unstyled mt-1"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Class Selection -->
        <div class="card mb-4">
            <div class="card-header">
                <h4 class="mb-0">‚öîÔ∏è Step 3: Choose Your Class</h4>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="class" class="form-label">Class</label>
                        <select class="form-select" id="class" required>
                            <option value="" selected disabled>Select Class</option>
                            <!-- Classes will be populated via JavaScript -->
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="subclass" class="form-label">Subclass (Choose at higher levels)</label>
                        <select class="form-select" id="subclass" style="display: none;">
                            <option value="" selected disabled>Select Subclass</option>
                        </select>
                    </div>
                </div>
                
                <!-- Class Information Panel -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div id="class-info-panel" class="p-3 bg-light rounded" style="display: none;">
                            <h6>Class Details</h6>
                            <div id="class-description"></div>
                            <div class="row mt-2">
                                <div class="col-md-4">
                                    <strong>Hit Die:</strong> <span id="class-hit-die"></span><br>
                                    <strong>Primary Abilities:</strong> <span id="class-primary-abilities"></span>
                                </div>
                                <div class="col-md-4">
                                    <strong>Saving Throws:</strong> <span id="class-saving-throws"></span><br>
                                    <strong>Armor Proficiencies:</strong> <span id="class-armor"></span>
                                </div>
                                <div class="col-md-4">
                                    <strong>Weapon Proficiencies:</strong> <span id="class-weapons"></span>
                                </div>
                            </div>
                            <div class="mt-2">
                                <strong>Class Features:</strong>
                                <div id="class-features"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Cantrip Selection (for spellcasting classes) -->
        <div class="card mb-4" id="cantrip-selection" style="display: none;">
            <div class="card-header">
                <h4 class="mb-0">‚ú® Step 4: Choose Your Cantrips</h4>
            </div>
            <div class="card-body">
                <div id="cantrip-info" class="mb-3">
                    <p class="text-muted">Select your starting cantrips based on your class.</p>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6>Available Cantrips</h6>
                        <div id="available-cantrips" class="cantrip-list" style="max-height: 400px; overflow-y: auto;">
                            <!-- Cantrips will be populated via JavaScript -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>Selected Cantrips (<span id="selected-count">0</span>/<span id="max-cantrips">0</span>)</h6>
                        <div id="selected-cantrips" class="cantrip-list mb-3" style="min-height: 100px;">
                            <p class="text-muted">No cantrips selected</p>
                        </div>
                        
                        <div class="mt-3">
                            <h6>Cantrip Details</h6>
                            <div id="cantrip-details" class="p-3 bg-light rounded">
                                <p class="text-muted">Click on a cantrip to see details</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Ability Scores -->
        <div class="card mb-4">
            <div class="card-header">
                <h4 class="mb-0">üé≤ Step 5: Determine Ability Scores</h4>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-12">
                        <label for="ability-method" class="form-label">Ability Score Method</label>
                        <select class="form-select" id="ability-method" required>
                            <option value="" selected disabled>Select Method</option>
                            <option value="standard">Standard Array (15, 14, 13, 12, 10, 8)</option>
                            <option value="pointbuy">Point Buy (27 points to spend)</option>
                            <option value="roll">Roll 4d6 (drop lowest)</option>
                            <option value="custom">Custom Values</option>
                        </select>
                    </div>
                </div>
            
            <!-- Ability Score Generation Panel -->
            <div class="col-12 mt-3">
                <div class="card" id="ability-score-panel" style="display: none;">
                    <div class="card-header">
                        <h5 class="mb-0">Ability Scores: <span id="selected-method-name"></span></h5>
                    </div>
                    <div class="card-body">
                        <div id="standard-array" style="display: none;">
                            <p class="mb-3">Assign the standard array values (15, 14, 13, 12, 10, 8) to your abilities:</p>
                            <div class="row">
                                <div class="col-md-2">
                                    <label class="form-label">Strength</label>
                                    <select class="form-select ability-assignment" data-ability="Strength">
                                        <option value="">-</option>
                                        <option value="15">15</option>
                                        <option value="14">14</option>
                                        <option value="13">13</option>
                                        <option value="12">12</option>
                                        <option value="10">10</option>
                                        <option value="8">8</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Dexterity</label>
                                    <select class="form-select ability-assignment" data-ability="Dexterity">
                                        <option value="">-</option>
                                        <option value="15">15</option>
                                        <option value="14">14</option>
                                        <option value="13">13</option>
                                        <option value="12">12</option>
                                        <option value="10">10</option>
                                        <option value="8">8</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Constitution</label>
                                    <select class="form-select ability-assignment" data-ability="Constitution">
                                        <option value="">-</option>
                                        <option value="15">15</option>
                                        <option value="14">14</option>
                                        <option value="13">13</option>
                                        <option value="12">12</option>
                                        <option value="10">10</option>
                                        <option value="8">8</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Intelligence</label>
                                    <select class="form-select ability-assignment" data-ability="Intelligence">
                                        <option value="">-</option>
                                        <option value="15">15</option>
                                        <option value="14">14</option>
                                        <option value="13">13</option>
                                        <option value="12">12</option>
                                        <option value="10">10</option>
                                        <option value="8">8</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Wisdom</label>
                                    <select class="form-select ability-assignment" data-ability="Wisdom">
                                        <option value="">-</option>
                                        <option value="15">15</option>
                                        <option value="14">14</option>
                                        <option value="13">13</option>
                                        <option value="12">12</option>
                                        <option value="10">10</option>
                                        <option value="8">8</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Charisma</label>
                                    <select class="form-select ability-assignment" data-ability="Charisma">
                                        <option value="">-</option>
                                        <option value="15">15</option>
                                        <option value="14">14</option>
                                        <option value="13">13</option>
                                        <option value="12">12</option>
                                        <option value="10">10</option>
                                        <option value="8">8</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div id="point-buy" style="display: none;">
                            <p class="mb-3">You have 27 points to spend. Each ability starts at 8. Costs: 9-13 = 1 point each, 14 = 2 points, 15 = 2 points</p>
                            <div class="row">
                                <div class="col-md-2">
                                    <label class="form-label">Strength</label>
                                    <div class="input-group">
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Strength', -1)">-</button>
                                        <input type="number" class="form-control text-center point-buy-input" id="pb-strength" value="8" min="8" max="15" readonly>
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Strength', 1)">+</button>
                                    </div>
                                    <small class="text-muted">Cost: <span id="pb-strength-cost">0</span></small>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Dexterity</label>
                                    <div class="input-group">
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Dexterity', -1)">-</button>
                                        <input type="number" class="form-control text-center point-buy-input" id="pb-dexterity" value="8" min="8" max="15" readonly>
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Dexterity', 1)">+</button>
                                    </div>
                                    <small class="text-muted">Cost: <span id="pb-dexterity-cost">0</span></small>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Constitution</label>
                                    <div class="input-group">
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Constitution', -1)">-</button>
                                        <input type="number" class="form-control text-center point-buy-input" id="pb-constitution" value="8" min="8" max="15" readonly>
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Constitution', 1)">+</button>
                                    </div>
                                    <small class="text-muted">Cost: <span id="pb-constitution-cost">0</span></small>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Intelligence</label>
                                    <div class="input-group">
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Intelligence', -1)">-</button>
                                        <input type="number" class="form-control text-center point-buy-input" id="pb-intelligence" value="8" min="8" max="15" readonly>
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Intelligence', 1)">+</button>
                                    </div>
                                    <small class="text-muted">Cost: <span id="pb-intelligence-cost">0</span></small>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Wisdom</label>
                                    <div class="input-group">
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Wisdom', -1)">-</button>
                                        <input type="number" class="form-control text-center point-buy-input" id="pb-wisdom" value="8" min="8" max="15" readonly>
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Wisdom', 1)">+</button>
                                    </div>
                                    <small class="text-muted">Cost: <span id="pb-wisdom-cost">0</span></small>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Charisma</label>
                                    <div class="input-group">
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Charisma', -1)">-</button>
                                        <input type="number" class="form-control text-center point-buy-input" id="pb-charisma" value="8" min="8" max="15" readonly>
                                        <button class="btn btn-outline-secondary" type="button" onclick="adjustPointBuy('Charisma', 1)">+</button>
                                    </div>
                                    <small class="text-muted">Cost: <span id="pb-charisma-cost">0</span></small>
                                </div>
                            </div>
                            <div class="mt-3">
                                <strong>Points Remaining: <span id="points-remaining">27</span></strong>
                            </div>
                        </div>
                        
                        <div id="roll-stats" style="display: none;">
                            <p class="mb-3">Roll 4d6, drop lowest for each ability score:</p>
                            <div class="row">
                                <div class="col-md-2">
                                    <label class="form-label">Strength</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control text-center rolled-stat" id="roll-strength" readonly>
                                        <button class="btn btn-outline-primary" type="button" onclick="rollStat('Strength')">Roll</button>
                                    </div>
                                    <small class="text-muted" id="roll-strength-detail"></small>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Dexterity</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control text-center rolled-stat" id="roll-dexterity" readonly>
                                        <button class="btn btn-outline-primary" type="button" onclick="rollStat('Dexterity')">Roll</button>
                                    </div>
                                    <small class="text-muted" id="roll-dexterity-detail"></small>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Constitution</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control text-center rolled-stat" id="roll-constitution" readonly>
                                        <button class="btn btn-outline-primary" type="button" onclick="rollStat('Constitution')">Roll</button>
                                    </div>
                                    <small class="text-muted" id="roll-constitution-detail"></small>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Intelligence</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control text-center rolled-stat" id="roll-intelligence" readonly>
                                        <button class="btn btn-outline-primary" type="button" onclick="rollStat('Intelligence')">Roll</button>
                                    </div>
                                    <small class="text-muted" id="roll-intelligence-detail"></small>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Wisdom</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control text-center rolled-stat" id="roll-wisdom" readonly>
                                        <button class="btn btn-outline-primary" type="button" onclick="rollStat('Wisdom')">Roll</button>
                                    </div>
                                    <small class="text-muted" id="roll-wisdom-detail"></small>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Charisma</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control text-center rolled-stat" id="roll-charisma" readonly>
                                        <button class="btn btn-outline-primary" type="button" onclick="rollStat('Charisma')">Roll</button>
                                    </div>
                                    <small class="text-muted" id="roll-charisma-detail"></small>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button type="button" class="btn btn-secondary" onclick="rollAllStats()">Roll All</button>
                            </div>
                        </div>
                        
                        <div id="custom-stats" style="display: none;">
                            <p class="mb-3">Enter custom ability scores (3-18):</p>
                            <div class="row">
                                <div class="col-md-2">
                                    <label class="form-label">Strength</label>
                                    <input type="number" class="form-control custom-stat" id="custom-strength" min="3" max="18" value="10">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Dexterity</label>
                                    <input type="number" class="form-control custom-stat" id="custom-dexterity" min="3" max="18" value="10">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Constitution</label>
                                    <input type="number" class="form-control custom-stat" id="custom-constitution" min="3" max="18" value="10">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Intelligence</label>
                                    <input type="number" class="form-control custom-stat" id="custom-intelligence" min="3" max="18" value="10">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Wisdom</label>
                                    <input type="number" class="form-control custom-stat" id="custom-wisdom" min="3" max="18" value="10">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Charisma</label>
                                    <input type="number" class="form-control custom-stat" id="custom-charisma" min="3" max="18" value="10">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Character Preview with Tabs -->
            <div class="col-12 mt-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Character Preview</h5>
                    </div>
                    <div class="card-body">
                        <!-- Preview Tabs -->
                        <ul class="nav nav-tabs mb-3" id="previewTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="attributes-tab" data-bs-toggle="tab" data-bs-target="#attributes-content" type="button" role="tab">Attributes</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="equipment-tab" data-bs-toggle="tab" data-bs-target="#equipment-content" type="button" role="tab">Equipment</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="spells-tab" data-bs-toggle="tab" data-bs-target="#spells-content" type="button" role="tab">Spells</button>
                            </li>
                        </ul>
                        
                        <!-- Tab Content -->
                        <div class="tab-content" id="previewTabContent">
                            <!-- Attributes Tab -->
                            <div class="tab-pane fade show active" id="attributes-content" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Final Attributes (Base + Racial)</h6>
                                        <ul class="list-group" id="attribute-preview">
                                            <li class="list-group-item d-flex justify-content-between">
                                                <span>Strength</span>
                                                <span id="str-value">10</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between">
                                                <span>Dexterity</span>
                                                <span id="dex-value">10</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between">
                                                <span>Constitution</span>
                                                <span id="con-value">10</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between">
                                                <span>Intelligence</span>
                                                <span id="int-value">10</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-
